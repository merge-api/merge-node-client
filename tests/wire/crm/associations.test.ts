// This file was auto-generated by Fern from our API Definition.

import { MergeClient } from "../../../src/Client";
import { mockServerPool } from "../../mock-server/MockServerPool";

describe("AssociationsClient", () => {
    test("custom_object_classes_custom_objects_associations_list", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({
            maxRetries: 0,
            apiKey: "test",
            accountToken: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = {
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    source_object: "a8f5d29f-4e50-473f-8f12-27128ffcd37a",
                    target_object: "da0b1963-be70-469c-9f8c-06a81d0fe759",
                    association_type: "association_type",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/crm/v1/custom-object-classes/custom_object_class_id/custom-objects/object_id/associations")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.crm.associations.customObjectClassesCustomObjectsAssociationsList(
            "custom_object_class_id",
            "object_id",
            {
                associationTypeId: "association_type_id",
                createdAfter: new Date("2024-01-15T09:30:00.000Z"),
                createdBefore: new Date("2024-01-15T09:30:00.000Z"),
                cursor: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
                expand: "association_type",
                includeDeletedData: true,
                includeRemoteData: true,
                includeShellData: true,
                modifiedAfter: new Date("2024-01-15T09:30:00.000Z"),
                modifiedBefore: new Date("2024-01-15T09:30:00.000Z"),
                pageSize: 1,
                remoteId: "remote_id",
            },
        );
        expect(response).toEqual({
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    sourceObject: "a8f5d29f-4e50-473f-8f12-27128ffcd37a",
                    targetObject: "da0b1963-be70-469c-9f8c-06a81d0fe759",
                    associationType: "association_type",
                },
            ],
        });
    });

    test("custom_object_classes_custom_objects_associations_update", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({
            maxRetries: 0,
            apiKey: "test",
            accountToken: "test",
            environment: server.baseUrl,
        });

        const rawResponseBody = {
            created_at: "2021-09-15T00:00:00Z",
            modified_at: "2021-10-16T00:00:00Z",
            source_object: "a8f5d29f-4e50-473f-8f12-27128ffcd37a",
            target_object: "da0b1963-be70-469c-9f8c-06a81d0fe759",
            association_type: "association_type",
        };
        server
            .mockEndpoint()
            .put(
                "/crm/v1/custom-object-classes/source_class_id/custom-objects/source_object_id/associations/target_class_id/target_object_id/association_type_id",
            )
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.crm.associations.customObjectClassesCustomObjectsAssociationsUpdate(
            "source_class_id",
            "source_object_id",
            "target_class_id",
            "target_object_id",
            "association_type_id",
            {
                isDebugMode: true,
                runAsync: true,
            },
        );
        expect(response).toEqual({
            createdAt: new Date("2021-09-15T00:00:00.000Z"),
            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
            sourceObject: "a8f5d29f-4e50-473f-8f12-27128ffcd37a",
            targetObject: "da0b1963-be70-469c-9f8c-06a81d0fe759",
            associationType: "association_type",
        });
    });
});
