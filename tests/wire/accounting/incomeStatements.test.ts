/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool";
import { MergeClient } from "../../../src/Client";

describe("IncomeStatements", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "0958cbc6-6040-430a-848e-aafacbadf4ae",
                    remote_id: "1342348",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    name: "IncomeStatement",
                    currency: "XUA",
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    start_period: "2024-01-15T09:30:00Z",
                    end_period: "2024-01-15T09:30:00Z",
                    income: [
                        {
                            remote_id: "10299",
                            created_at: "2021-09-15T00:00:00Z",
                            modified_at: "2021-10-16T00:00:00Z",
                            name: "Total Income",
                            value: 325,
                            sub_items: {
                                "0": { remote_id: "10200", name: "Landscaping Services", value: 425 },
                                "1": { remote_id: "10201", name: "Pest Control Services", value: -100 },
                            },
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    cost_of_sales: [
                        {
                            remote_id: "10299",
                            created_at: "2021-09-15T00:00:00Z",
                            modified_at: "2021-10-16T00:00:00Z",
                            name: "Total COGS",
                            value: 25,
                            sub_items: { "0": { remote_id: "10200", name: "Supplies", value: 10 } },
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    gross_profit: 300,
                    operating_expenses: [
                        {
                            remote_id: "10299",
                            created_at: "2021-09-15T00:00:00Z",
                            modified_at: "2021-10-16T00:00:00Z",
                            name: "Total Operating Expenses",
                            value: 100,
                            sub_items: { key: "value" },
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    net_operating_income: 200,
                    non_operating_expenses: [
                        {
                            remote_id: "10299",
                            created_at: "2021-09-15T00:00:00Z",
                            modified_at: "2021-10-16T00:00:00Z",
                            name: "Total Non-Operating Expenses",
                            value: 100,
                            sub_items: { key: "value" },
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    net_income: 100,
                    remote_was_deleted: true,
                    field_mappings: {
                        organization_defined_targets: { custom_key: "custom_value" },
                        linked_account_defined_targets: { custom_key: "custom_value" },
                    },
                    remote_data: [{ path: "/actions", data: ["Varies by platform"] }],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/income-statements")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.incomeStatements.list({
            cursor: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
        });
        expect(response).toEqual({
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "0958cbc6-6040-430a-848e-aafacbadf4ae",
                    remoteId: "1342348",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    name: "IncomeStatement",
                    currency: "XUA",
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    startPeriod: new Date("2024-01-15T09:30:00.000Z"),
                    endPeriod: new Date("2024-01-15T09:30:00.000Z"),
                    income: [
                        {
                            remoteId: "10299",
                            createdAt: new Date("2021-09-15T00:00:00.000Z"),
                            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                            name: "Total Income",
                            value: 325,
                            subItems: {
                                "0": {
                                    remote_id: "10200",
                                    name: "Landscaping Services",
                                    value: 425,
                                },
                                "1": {
                                    remote_id: "10201",
                                    name: "Pest Control Services",
                                    value: -100,
                                },
                            },
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    costOfSales: [
                        {
                            remoteId: "10299",
                            createdAt: new Date("2021-09-15T00:00:00.000Z"),
                            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                            name: "Total COGS",
                            value: 25,
                            subItems: {
                                "0": {
                                    remote_id: "10200",
                                    name: "Supplies",
                                    value: 10,
                                },
                            },
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    grossProfit: 300,
                    operatingExpenses: [
                        {
                            remoteId: "10299",
                            createdAt: new Date("2021-09-15T00:00:00.000Z"),
                            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                            name: "Total Operating Expenses",
                            value: 100,
                            subItems: {
                                key: "value",
                            },
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    netOperatingIncome: 200,
                    nonOperatingExpenses: [
                        {
                            remoteId: "10299",
                            createdAt: new Date("2021-09-15T00:00:00.000Z"),
                            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                            name: "Total Non-Operating Expenses",
                            value: 100,
                            subItems: {
                                key: "value",
                            },
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    netIncome: 100,
                    remoteWasDeleted: true,
                    fieldMappings: {
                        organization_defined_targets: {
                            custom_key: "custom_value",
                        },
                        linked_account_defined_targets: {
                            custom_key: "custom_value",
                        },
                    },
                    remoteData: [
                        {
                            path: "/actions",
                            data: ["Varies by platform"],
                        },
                    ],
                },
            ],
        });
    });

    test("retrieve", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "0958cbc6-6040-430a-848e-aafacbadf4ae",
            remote_id: "1342348",
            created_at: "2021-09-15T00:00:00Z",
            modified_at: "2021-10-16T00:00:00Z",
            name: "IncomeStatement",
            currency: "XUA",
            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
            start_period: "2024-01-15T09:30:00Z",
            end_period: "2024-01-15T09:30:00Z",
            income: [
                {
                    remote_id: "10299",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    name: "Total Income",
                    value: 325,
                    sub_items: {
                        "0": { remote_id: "10200", name: "Landscaping Services", value: 425 },
                        "1": { remote_id: "10201", name: "Pest Control Services", value: -100 },
                    },
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remote_was_deleted: true,
                },
            ],
            cost_of_sales: [
                {
                    remote_id: "10299",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    name: "Total COGS",
                    value: 25,
                    sub_items: { "0": { remote_id: "10200", name: "Supplies", value: 10 } },
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remote_was_deleted: true,
                },
            ],
            gross_profit: 300,
            operating_expenses: [
                {
                    remote_id: "10299",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    name: "Total Operating Expenses",
                    value: 100,
                    sub_items: { key: "value" },
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remote_was_deleted: true,
                },
            ],
            net_operating_income: 200,
            non_operating_expenses: [
                {
                    remote_id: "10299",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    name: "Total Non-Operating Expenses",
                    value: 100,
                    sub_items: { key: "value" },
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remote_was_deleted: true,
                },
            ],
            net_income: 100,
            remote_was_deleted: true,
            field_mappings: {
                organization_defined_targets: { custom_key: "custom_value" },
                linked_account_defined_targets: { custom_key: "custom_value" },
            },
            remote_data: [{ path: "/actions", data: ["Varies by platform"] }],
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/income-statements/id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.incomeStatements.retrieve("id");
        expect(response).toEqual({
            id: "0958cbc6-6040-430a-848e-aafacbadf4ae",
            remoteId: "1342348",
            createdAt: new Date("2021-09-15T00:00:00.000Z"),
            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
            name: "IncomeStatement",
            currency: "XUA",
            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
            startPeriod: new Date("2024-01-15T09:30:00.000Z"),
            endPeriod: new Date("2024-01-15T09:30:00.000Z"),
            income: [
                {
                    remoteId: "10299",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    name: "Total Income",
                    value: 325,
                    subItems: {
                        "0": {
                            remote_id: "10200",
                            name: "Landscaping Services",
                            value: 425,
                        },
                        "1": {
                            remote_id: "10201",
                            name: "Pest Control Services",
                            value: -100,
                        },
                    },
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remoteWasDeleted: true,
                },
            ],
            costOfSales: [
                {
                    remoteId: "10299",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    name: "Total COGS",
                    value: 25,
                    subItems: {
                        "0": {
                            remote_id: "10200",
                            name: "Supplies",
                            value: 10,
                        },
                    },
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remoteWasDeleted: true,
                },
            ],
            grossProfit: 300,
            operatingExpenses: [
                {
                    remoteId: "10299",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    name: "Total Operating Expenses",
                    value: 100,
                    subItems: {
                        key: "value",
                    },
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remoteWasDeleted: true,
                },
            ],
            netOperatingIncome: 200,
            nonOperatingExpenses: [
                {
                    remoteId: "10299",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    name: "Total Non-Operating Expenses",
                    value: 100,
                    subItems: {
                        key: "value",
                    },
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remoteWasDeleted: true,
                },
            ],
            netIncome: 100,
            remoteWasDeleted: true,
            fieldMappings: {
                organization_defined_targets: {
                    custom_key: "custom_value",
                },
                linked_account_defined_targets: {
                    custom_key: "custom_value",
                },
            },
            remoteData: [
                {
                    path: "/actions",
                    data: ["Varies by platform"],
                },
            ],
        });
    });
});
