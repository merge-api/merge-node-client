/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool";
import { MergeClient } from "../../../src/Client";

describe("Invoices", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "9871b4a9-f5d2-4f3b-a66b-dfedbed42c46",
                    remote_id: "990110",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    type: "ACCOUNTS_RECEIVABLE",
                    contact: "contact",
                    number: "AIQ12546",
                    issue_date: "2020-03-31T00:00:00Z",
                    due_date: "2020-04-15T00:00:00Z",
                    paid_on_date: "2020-04-01T00:00:00Z",
                    memo: "Weekly Payment",
                    company: "company",
                    employee: "employee",
                    currency: "XUA",
                    exchange_rate: "2.9",
                    payment_term: "payment_term",
                    total_discount: 1.1,
                    sub_total: 100,
                    status: "PAID",
                    total_tax_amount: 5,
                    total_amount: 105,
                    balance: 105,
                    remote_updated_at: "2020-04-01T00:00:00Z",
                    tracking_categories: [
                        "7dc5ca17-d311-44cd-9ce0-333080367a18",
                        "6aa0700c-48e1-4c4a-8162-02e6a582df05",
                        "8c933d61-8f5b-4360-ac0c-c9dc87bee763",
                    ],
                    accounting_period: "accounting_period",
                    purchase_orders: [
                        "e7378d8f-3992-4c2a-8417-ebdc4f2bfeb7",
                        "dd70ca2f-b120-46fa-889a-9604037f45fd",
                        "889b281d-739c-4759-95b8-0aedb3947131",
                    ],
                    payments: ["b26fd49a-cbae-470a-a8f8-bcbc119e0390"],
                    applied_payments: ["9017594e-dc33-4113-a5d2-b0f928e34fdd"],
                    line_items: [
                        {
                            id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                            remote_id: "8765432",
                            created_at: "2021-09-15T00:00:00Z",
                            modified_at: "2021-10-16T00:00:00Z",
                            description: "Pickleball lessons",
                            unit_price: 50,
                            quantity: 1,
                            total_amount: 50,
                            employee: "7442f0d5-722d-45bd-b807-6e38489d37fe",
                            project: "22e65a5d-2df5-4e6e-884a-e538d0339000",
                            contact: "908934-49j9-093f-0989-908923908",
                            currency: "USD",
                            exchange_rate: "2.9",
                            item: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                            account: "cd0f32d4-a493-11ec-b909-0242ac120002",
                            tax_rate: "a12e7c20-1922-9df7-s75n-edfeewnn7384",
                            tracking_categories: [
                                "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                                "9b840d2-686a-465a-8a8e-7b028498f8e4",
                                "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                            ],
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    applied_credit_notes: [
                        {
                            created_at: "2021-09-15T00:00:00Z",
                            modified_at: "2021-10-16T00:00:00Z",
                            credit_note: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                            applied_date: "2020-03-31T00:00:00Z",
                            applied_amount: "2.9",
                        },
                    ],
                    applied_vendor_credits: [
                        {
                            created_at: "2021-09-15T00:00:00Z",
                            modified_at: "2021-10-16T00:00:00Z",
                            vendor_credit: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                            applied_date: "2020-03-31T00:00:00Z",
                            applied_amount: "2.9",
                        },
                    ],
                    inclusive_of_tax: true,
                    remote_was_deleted: true,
                    field_mappings: {
                        organization_defined_targets: { custom_key: "custom_value" },
                        linked_account_defined_targets: { custom_key: "custom_value" },
                    },
                    remote_data: [{ path: "/actions", data: ["Varies by platform"] }],
                    remote_fields: [{ remote_field_class: "remote_field_class" }],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/invoices")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.invoices.list();
        expect(response).toEqual({
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "9871b4a9-f5d2-4f3b-a66b-dfedbed42c46",
                    remoteId: "990110",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    type: "ACCOUNTS_RECEIVABLE",
                    contact: "contact",
                    number: "AIQ12546",
                    issueDate: new Date("2020-03-31T00:00:00.000Z"),
                    dueDate: new Date("2020-04-15T00:00:00.000Z"),
                    paidOnDate: new Date("2020-04-01T00:00:00.000Z"),
                    memo: "Weekly Payment",
                    company: "company",
                    employee: "employee",
                    currency: "XUA",
                    exchangeRate: "2.9",
                    paymentTerm: "payment_term",
                    totalDiscount: 1.1,
                    subTotal: 100,
                    status: "PAID",
                    totalTaxAmount: 5,
                    totalAmount: 105,
                    balance: 105,
                    remoteUpdatedAt: new Date("2020-04-01T00:00:00.000Z"),
                    trackingCategories: [
                        "7dc5ca17-d311-44cd-9ce0-333080367a18",
                        "6aa0700c-48e1-4c4a-8162-02e6a582df05",
                        "8c933d61-8f5b-4360-ac0c-c9dc87bee763",
                    ],
                    accountingPeriod: "accounting_period",
                    purchaseOrders: [
                        "e7378d8f-3992-4c2a-8417-ebdc4f2bfeb7",
                        "dd70ca2f-b120-46fa-889a-9604037f45fd",
                        "889b281d-739c-4759-95b8-0aedb3947131",
                    ],
                    payments: ["b26fd49a-cbae-470a-a8f8-bcbc119e0390"],
                    appliedPayments: ["9017594e-dc33-4113-a5d2-b0f928e34fdd"],
                    lineItems: [
                        {
                            id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                            remoteId: "8765432",
                            createdAt: new Date("2021-09-15T00:00:00.000Z"),
                            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                            description: "Pickleball lessons",
                            unitPrice: 50,
                            quantity: 1,
                            totalAmount: 50,
                            employee: "7442f0d5-722d-45bd-b807-6e38489d37fe",
                            project: "22e65a5d-2df5-4e6e-884a-e538d0339000",
                            contact: "908934-49j9-093f-0989-908923908",
                            currency: "USD",
                            exchangeRate: "2.9",
                            item: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                            account: "cd0f32d4-a493-11ec-b909-0242ac120002",
                            taxRate: "a12e7c20-1922-9df7-s75n-edfeewnn7384",
                            trackingCategories: [
                                "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                                "9b840d2-686a-465a-8a8e-7b028498f8e4",
                                "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                            ],
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                        },
                    ],
                    appliedCreditNotes: [
                        {
                            createdAt: new Date("2021-09-15T00:00:00.000Z"),
                            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                            creditNote: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                            appliedDate: new Date("2020-03-31T00:00:00.000Z"),
                            appliedAmount: "2.9",
                        },
                    ],
                    appliedVendorCredits: [
                        {
                            createdAt: new Date("2021-09-15T00:00:00.000Z"),
                            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                            vendorCredit: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                            appliedDate: new Date("2020-03-31T00:00:00.000Z"),
                            appliedAmount: "2.9",
                        },
                    ],
                    inclusiveOfTax: true,
                    remoteWasDeleted: true,
                    fieldMappings: {
                        organization_defined_targets: {
                            custom_key: "custom_value",
                        },
                        linked_account_defined_targets: {
                            custom_key: "custom_value",
                        },
                    },
                    remoteData: [
                        {
                            path: "/actions",
                            data: ["Varies by platform"],
                        },
                    ],
                    remoteFields: [
                        {
                            remoteFieldClass: "remote_field_class",
                        },
                    ],
                },
            ],
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });
        const rawRequestBody = { model: {} };
        const rawResponseBody = {
            model: {
                id: "9871b4a9-f5d2-4f3b-a66b-dfedbed42c46",
                remote_id: "990110",
                created_at: "2021-09-15T00:00:00Z",
                modified_at: "2021-10-16T00:00:00Z",
                type: "ACCOUNTS_RECEIVABLE",
                contact: "contact",
                number: "AIQ12546",
                issue_date: "2020-03-31T00:00:00Z",
                due_date: "2020-04-15T00:00:00Z",
                paid_on_date: "2020-04-01T00:00:00Z",
                memo: "Weekly Payment",
                company: "company",
                employee: "employee",
                currency: "XUA",
                exchange_rate: "2.9",
                payment_term: "payment_term",
                total_discount: 1.1,
                sub_total: 100,
                status: "PAID",
                total_tax_amount: 5,
                total_amount: 105,
                balance: 105,
                remote_updated_at: "2020-04-01T00:00:00Z",
                tracking_categories: [
                    "7dc5ca17-d311-44cd-9ce0-333080367a18",
                    "6aa0700c-48e1-4c4a-8162-02e6a582df05",
                    "8c933d61-8f5b-4360-ac0c-c9dc87bee763",
                ],
                accounting_period: "accounting_period",
                purchase_orders: [
                    "e7378d8f-3992-4c2a-8417-ebdc4f2bfeb7",
                    "dd70ca2f-b120-46fa-889a-9604037f45fd",
                    "889b281d-739c-4759-95b8-0aedb3947131",
                ],
                payments: ["b26fd49a-cbae-470a-a8f8-bcbc119e0390"],
                applied_payments: ["9017594e-dc33-4113-a5d2-b0f928e34fdd"],
                line_items: [
                    {
                        id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                        remote_id: "8765432",
                        created_at: "2021-09-15T00:00:00Z",
                        modified_at: "2021-10-16T00:00:00Z",
                        description: "Pickleball lessons",
                        unit_price: 50,
                        quantity: 1,
                        total_amount: 50,
                        employee: "7442f0d5-722d-45bd-b807-6e38489d37fe",
                        project: "22e65a5d-2df5-4e6e-884a-e538d0339000",
                        contact: "908934-49j9-093f-0989-908923908",
                        currency: "USD",
                        exchange_rate: "2.9",
                        item: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        account: "cd0f32d4-a493-11ec-b909-0242ac120002",
                        tax_rate: "a12e7c20-1922-9df7-s75n-edfeewnn7384",
                        tracking_categories: [
                            "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                            "9b840d2-686a-465a-8a8e-7b028498f8e4",
                            "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                        ],
                        company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    },
                ],
                applied_credit_notes: [
                    {
                        created_at: "2021-09-15T00:00:00Z",
                        modified_at: "2021-10-16T00:00:00Z",
                        credit_note: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        applied_date: "2020-03-31T00:00:00Z",
                        applied_amount: "2.9",
                    },
                ],
                applied_vendor_credits: [
                    {
                        created_at: "2021-09-15T00:00:00Z",
                        modified_at: "2021-10-16T00:00:00Z",
                        vendor_credit: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        applied_date: "2020-03-31T00:00:00Z",
                        applied_amount: "2.9",
                    },
                ],
                inclusive_of_tax: true,
                remote_was_deleted: true,
                field_mappings: {
                    organization_defined_targets: { custom_key: "custom_value" },
                    linked_account_defined_targets: { custom_key: "custom_value" },
                },
                remote_data: [{ path: "/actions", data: ["Varies by platform"] }],
                remote_fields: [{ remote_field_class: "remote_field_class" }],
            },
            warnings: [
                {
                    source: { pointer: "pointer" },
                    title: "Unrecognized Field",
                    detail: "An unrecognized field, age, was passed in with request data.",
                    problem_type: "UNRECOGNIZED_FIELD",
                },
            ],
            errors: [
                {
                    source: { pointer: "pointer" },
                    title: "Missing Required Field",
                    detail: "custom_fields is a required field on model.",
                    problem_type: "MISSING_REQUIRED_FIELD",
                },
            ],
            logs: [
                {
                    log_id: "99433219-8017-4acd-bb3c-ceb23d663832",
                    dashboard_view: "https://app.merge.dev/logs/99433219-8017-4acd-bb3c-ceb23d663832",
                    log_summary: {
                        url: "www.exampleintegration.com/api/v1/exampleapi",
                        method: "POST",
                        status_code: 200,
                    },
                },
            ],
        };
        server
            .mockEndpoint()
            .post("/accounting/v1/invoices")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.invoices.create({
            model: {},
        });
        expect(response).toEqual({
            model: {
                id: "9871b4a9-f5d2-4f3b-a66b-dfedbed42c46",
                remoteId: "990110",
                createdAt: new Date("2021-09-15T00:00:00.000Z"),
                modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                type: "ACCOUNTS_RECEIVABLE",
                contact: "contact",
                number: "AIQ12546",
                issueDate: new Date("2020-03-31T00:00:00.000Z"),
                dueDate: new Date("2020-04-15T00:00:00.000Z"),
                paidOnDate: new Date("2020-04-01T00:00:00.000Z"),
                memo: "Weekly Payment",
                company: "company",
                employee: "employee",
                currency: "XUA",
                exchangeRate: "2.9",
                paymentTerm: "payment_term",
                totalDiscount: 1.1,
                subTotal: 100,
                status: "PAID",
                totalTaxAmount: 5,
                totalAmount: 105,
                balance: 105,
                remoteUpdatedAt: new Date("2020-04-01T00:00:00.000Z"),
                trackingCategories: [
                    "7dc5ca17-d311-44cd-9ce0-333080367a18",
                    "6aa0700c-48e1-4c4a-8162-02e6a582df05",
                    "8c933d61-8f5b-4360-ac0c-c9dc87bee763",
                ],
                accountingPeriod: "accounting_period",
                purchaseOrders: [
                    "e7378d8f-3992-4c2a-8417-ebdc4f2bfeb7",
                    "dd70ca2f-b120-46fa-889a-9604037f45fd",
                    "889b281d-739c-4759-95b8-0aedb3947131",
                ],
                payments: ["b26fd49a-cbae-470a-a8f8-bcbc119e0390"],
                appliedPayments: ["9017594e-dc33-4113-a5d2-b0f928e34fdd"],
                lineItems: [
                    {
                        id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                        remoteId: "8765432",
                        createdAt: new Date("2021-09-15T00:00:00.000Z"),
                        modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                        description: "Pickleball lessons",
                        unitPrice: 50,
                        quantity: 1,
                        totalAmount: 50,
                        employee: "7442f0d5-722d-45bd-b807-6e38489d37fe",
                        project: "22e65a5d-2df5-4e6e-884a-e538d0339000",
                        contact: "908934-49j9-093f-0989-908923908",
                        currency: "USD",
                        exchangeRate: "2.9",
                        item: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        account: "cd0f32d4-a493-11ec-b909-0242ac120002",
                        taxRate: "a12e7c20-1922-9df7-s75n-edfeewnn7384",
                        trackingCategories: [
                            "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                            "9b840d2-686a-465a-8a8e-7b028498f8e4",
                            "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                        ],
                        company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    },
                ],
                appliedCreditNotes: [
                    {
                        createdAt: new Date("2021-09-15T00:00:00.000Z"),
                        modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                        creditNote: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        appliedDate: new Date("2020-03-31T00:00:00.000Z"),
                        appliedAmount: "2.9",
                    },
                ],
                appliedVendorCredits: [
                    {
                        createdAt: new Date("2021-09-15T00:00:00.000Z"),
                        modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                        vendorCredit: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        appliedDate: new Date("2020-03-31T00:00:00.000Z"),
                        appliedAmount: "2.9",
                    },
                ],
                inclusiveOfTax: true,
                remoteWasDeleted: true,
                fieldMappings: {
                    organization_defined_targets: {
                        custom_key: "custom_value",
                    },
                    linked_account_defined_targets: {
                        custom_key: "custom_value",
                    },
                },
                remoteData: [
                    {
                        path: "/actions",
                        data: ["Varies by platform"],
                    },
                ],
                remoteFields: [
                    {
                        remoteFieldClass: "remote_field_class",
                    },
                ],
            },
            warnings: [
                {
                    source: {
                        pointer: "pointer",
                    },
                    title: "Unrecognized Field",
                    detail: "An unrecognized field, age, was passed in with request data.",
                    problemType: "UNRECOGNIZED_FIELD",
                },
            ],
            errors: [
                {
                    source: {
                        pointer: "pointer",
                    },
                    title: "Missing Required Field",
                    detail: "custom_fields is a required field on model.",
                    problemType: "MISSING_REQUIRED_FIELD",
                },
            ],
            logs: [
                {
                    logId: "99433219-8017-4acd-bb3c-ceb23d663832",
                    dashboardView: "https://app.merge.dev/logs/99433219-8017-4acd-bb3c-ceb23d663832",
                    logSummary: {
                        url: "www.exampleintegration.com/api/v1/exampleapi",
                        method: "POST",
                        statusCode: 200,
                    },
                },
            ],
        });
    });

    test("retrieve", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "9871b4a9-f5d2-4f3b-a66b-dfedbed42c46",
            remote_id: "990110",
            created_at: "2021-09-15T00:00:00Z",
            modified_at: "2021-10-16T00:00:00Z",
            type: "ACCOUNTS_RECEIVABLE",
            contact: "contact",
            number: "AIQ12546",
            issue_date: "2020-03-31T00:00:00Z",
            due_date: "2020-04-15T00:00:00Z",
            paid_on_date: "2020-04-01T00:00:00Z",
            memo: "Weekly Payment",
            company: "company",
            employee: "employee",
            currency: "XUA",
            exchange_rate: "2.9",
            payment_term: "payment_term",
            total_discount: 1.1,
            sub_total: 100,
            status: "PAID",
            total_tax_amount: 5,
            total_amount: 105,
            balance: 105,
            remote_updated_at: "2020-04-01T00:00:00Z",
            tracking_categories: [
                "7dc5ca17-d311-44cd-9ce0-333080367a18",
                "6aa0700c-48e1-4c4a-8162-02e6a582df05",
                "8c933d61-8f5b-4360-ac0c-c9dc87bee763",
            ],
            accounting_period: "accounting_period",
            purchase_orders: [
                "e7378d8f-3992-4c2a-8417-ebdc4f2bfeb7",
                "dd70ca2f-b120-46fa-889a-9604037f45fd",
                "889b281d-739c-4759-95b8-0aedb3947131",
            ],
            payments: ["b26fd49a-cbae-470a-a8f8-bcbc119e0390"],
            applied_payments: ["9017594e-dc33-4113-a5d2-b0f928e34fdd"],
            line_items: [
                {
                    id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                    remote_id: "8765432",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    description: "Pickleball lessons",
                    unit_price: 50,
                    quantity: 1,
                    total_amount: 50,
                    employee: "7442f0d5-722d-45bd-b807-6e38489d37fe",
                    project: "22e65a5d-2df5-4e6e-884a-e538d0339000",
                    contact: "908934-49j9-093f-0989-908923908",
                    currency: "USD",
                    exchange_rate: "2.9",
                    item: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                    account: "cd0f32d4-a493-11ec-b909-0242ac120002",
                    tax_rate: "a12e7c20-1922-9df7-s75n-edfeewnn7384",
                    tracking_category: "tracking_category",
                    tracking_categories: [
                        "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                        "9b840d2-686a-465a-8a8e-7b028498f8e4",
                        "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    ],
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remote_was_deleted: true,
                    field_mappings: {
                        organization_defined_targets: { custom_key: "custom_value" },
                        linked_account_defined_targets: { custom_key: "custom_value" },
                    },
                    remote_fields: [{ remote_field_class: "remote_field_class" }],
                },
            ],
            applied_credit_notes: [
                {
                    remote_id: "088899",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    credit_note: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                    applied_date: "2020-03-31T00:00:00Z",
                    applied_amount: "2.9",
                    remote_was_deleted: true,
                },
            ],
            applied_vendor_credits: [
                {
                    remote_id: "088899",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    vendor_credit: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                    applied_date: "2020-03-31T00:00:00Z",
                    applied_amount: "2.9",
                    remote_was_deleted: true,
                },
            ],
            inclusive_of_tax: true,
            remote_was_deleted: true,
            field_mappings: {
                organization_defined_targets: { custom_key: "custom_value" },
                linked_account_defined_targets: { custom_key: "custom_value" },
            },
            remote_data: [{ path: "/actions", data: ["Varies by platform"] }],
            remote_fields: [{ remote_field_class: "remote_field_class", value: { key: "value" } }],
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/invoices/id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.invoices.retrieve("id");
        expect(response).toEqual({
            id: "9871b4a9-f5d2-4f3b-a66b-dfedbed42c46",
            remoteId: "990110",
            createdAt: new Date("2021-09-15T00:00:00.000Z"),
            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
            type: "ACCOUNTS_RECEIVABLE",
            contact: "contact",
            number: "AIQ12546",
            issueDate: new Date("2020-03-31T00:00:00.000Z"),
            dueDate: new Date("2020-04-15T00:00:00.000Z"),
            paidOnDate: new Date("2020-04-01T00:00:00.000Z"),
            memo: "Weekly Payment",
            company: "company",
            employee: "employee",
            currency: "XUA",
            exchangeRate: "2.9",
            paymentTerm: "payment_term",
            totalDiscount: 1.1,
            subTotal: 100,
            status: "PAID",
            totalTaxAmount: 5,
            totalAmount: 105,
            balance: 105,
            remoteUpdatedAt: new Date("2020-04-01T00:00:00.000Z"),
            trackingCategories: [
                "7dc5ca17-d311-44cd-9ce0-333080367a18",
                "6aa0700c-48e1-4c4a-8162-02e6a582df05",
                "8c933d61-8f5b-4360-ac0c-c9dc87bee763",
            ],
            accountingPeriod: "accounting_period",
            purchaseOrders: [
                "e7378d8f-3992-4c2a-8417-ebdc4f2bfeb7",
                "dd70ca2f-b120-46fa-889a-9604037f45fd",
                "889b281d-739c-4759-95b8-0aedb3947131",
            ],
            payments: ["b26fd49a-cbae-470a-a8f8-bcbc119e0390"],
            appliedPayments: ["9017594e-dc33-4113-a5d2-b0f928e34fdd"],
            lineItems: [
                {
                    id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                    remoteId: "8765432",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    description: "Pickleball lessons",
                    unitPrice: 50,
                    quantity: 1,
                    totalAmount: 50,
                    employee: "7442f0d5-722d-45bd-b807-6e38489d37fe",
                    project: "22e65a5d-2df5-4e6e-884a-e538d0339000",
                    contact: "908934-49j9-093f-0989-908923908",
                    currency: "USD",
                    exchangeRate: "2.9",
                    item: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                    account: "cd0f32d4-a493-11ec-b909-0242ac120002",
                    taxRate: "a12e7c20-1922-9df7-s75n-edfeewnn7384",
                    trackingCategory: "tracking_category",
                    trackingCategories: [
                        "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                        "9b840d2-686a-465a-8a8e-7b028498f8e4",
                        "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    ],
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    remoteWasDeleted: true,
                    fieldMappings: {
                        organization_defined_targets: {
                            custom_key: "custom_value",
                        },
                        linked_account_defined_targets: {
                            custom_key: "custom_value",
                        },
                    },
                    remoteFields: [
                        {
                            remoteFieldClass: "remote_field_class",
                        },
                    ],
                },
            ],
            appliedCreditNotes: [
                {
                    remoteId: "088899",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    creditNote: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                    appliedDate: new Date("2020-03-31T00:00:00.000Z"),
                    appliedAmount: "2.9",
                    remoteWasDeleted: true,
                },
            ],
            appliedVendorCredits: [
                {
                    remoteId: "088899",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    vendorCredit: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                    appliedDate: new Date("2020-03-31T00:00:00.000Z"),
                    appliedAmount: "2.9",
                    remoteWasDeleted: true,
                },
            ],
            inclusiveOfTax: true,
            remoteWasDeleted: true,
            fieldMappings: {
                organization_defined_targets: {
                    custom_key: "custom_value",
                },
                linked_account_defined_targets: {
                    custom_key: "custom_value",
                },
            },
            remoteData: [
                {
                    path: "/actions",
                    data: ["Varies by platform"],
                },
            ],
            remoteFields: [
                {
                    remoteFieldClass: "remote_field_class",
                    value: {
                        key: "value",
                    },
                },
            ],
        });
    });

    test("partialUpdate", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });
        const rawRequestBody = { model: {} };
        const rawResponseBody = {
            model: {
                id: "9871b4a9-f5d2-4f3b-a66b-dfedbed42c46",
                remote_id: "990110",
                created_at: "2021-09-15T00:00:00Z",
                modified_at: "2021-10-16T00:00:00Z",
                type: "ACCOUNTS_RECEIVABLE",
                contact: "contact",
                number: "AIQ12546",
                issue_date: "2020-03-31T00:00:00Z",
                due_date: "2020-04-15T00:00:00Z",
                paid_on_date: "2020-04-01T00:00:00Z",
                memo: "Weekly Payment",
                company: "company",
                employee: "employee",
                currency: "XUA",
                exchange_rate: "2.9",
                payment_term: "payment_term",
                total_discount: 1.1,
                sub_total: 100,
                status: "PAID",
                total_tax_amount: 5,
                total_amount: 105,
                balance: 105,
                remote_updated_at: "2020-04-01T00:00:00Z",
                tracking_categories: [
                    "7dc5ca17-d311-44cd-9ce0-333080367a18",
                    "6aa0700c-48e1-4c4a-8162-02e6a582df05",
                    "8c933d61-8f5b-4360-ac0c-c9dc87bee763",
                ],
                accounting_period: "accounting_period",
                purchase_orders: [
                    "e7378d8f-3992-4c2a-8417-ebdc4f2bfeb7",
                    "dd70ca2f-b120-46fa-889a-9604037f45fd",
                    "889b281d-739c-4759-95b8-0aedb3947131",
                ],
                payments: ["b26fd49a-cbae-470a-a8f8-bcbc119e0390"],
                applied_payments: ["9017594e-dc33-4113-a5d2-b0f928e34fdd"],
                line_items: [
                    {
                        id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                        remote_id: "8765432",
                        created_at: "2021-09-15T00:00:00Z",
                        modified_at: "2021-10-16T00:00:00Z",
                        description: "Pickleball lessons",
                        unit_price: 50,
                        quantity: 1,
                        total_amount: 50,
                        employee: "7442f0d5-722d-45bd-b807-6e38489d37fe",
                        project: "22e65a5d-2df5-4e6e-884a-e538d0339000",
                        contact: "908934-49j9-093f-0989-908923908",
                        currency: "USD",
                        exchange_rate: "2.9",
                        item: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        account: "cd0f32d4-a493-11ec-b909-0242ac120002",
                        tax_rate: "a12e7c20-1922-9df7-s75n-edfeewnn7384",
                        tracking_categories: [
                            "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                            "9b840d2-686a-465a-8a8e-7b028498f8e4",
                            "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                        ],
                        company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    },
                ],
                applied_credit_notes: [
                    {
                        created_at: "2021-09-15T00:00:00Z",
                        modified_at: "2021-10-16T00:00:00Z",
                        credit_note: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        applied_date: "2020-03-31T00:00:00Z",
                        applied_amount: "2.9",
                    },
                ],
                applied_vendor_credits: [
                    {
                        created_at: "2021-09-15T00:00:00Z",
                        modified_at: "2021-10-16T00:00:00Z",
                        vendor_credit: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        applied_date: "2020-03-31T00:00:00Z",
                        applied_amount: "2.9",
                    },
                ],
                inclusive_of_tax: true,
                remote_was_deleted: true,
                field_mappings: {
                    organization_defined_targets: { custom_key: "custom_value" },
                    linked_account_defined_targets: { custom_key: "custom_value" },
                },
                remote_data: [{ path: "/actions", data: ["Varies by platform"] }],
                remote_fields: [{ remote_field_class: "remote_field_class" }],
            },
            warnings: [
                {
                    source: { pointer: "pointer" },
                    title: "Unrecognized Field",
                    detail: "An unrecognized field, age, was passed in with request data.",
                    problem_type: "UNRECOGNIZED_FIELD",
                },
            ],
            errors: [
                {
                    source: { pointer: "pointer" },
                    title: "Missing Required Field",
                    detail: "custom_fields is a required field on model.",
                    problem_type: "MISSING_REQUIRED_FIELD",
                },
            ],
            logs: [
                {
                    log_id: "99433219-8017-4acd-bb3c-ceb23d663832",
                    dashboard_view: "https://app.merge.dev/logs/99433219-8017-4acd-bb3c-ceb23d663832",
                    log_summary: {
                        url: "www.exampleintegration.com/api/v1/exampleapi",
                        method: "POST",
                        status_code: 200,
                    },
                },
            ],
        };
        server
            .mockEndpoint()
            .patch("/accounting/v1/invoices/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.invoices.partialUpdate("id", {
            model: {},
        });
        expect(response).toEqual({
            model: {
                id: "9871b4a9-f5d2-4f3b-a66b-dfedbed42c46",
                remoteId: "990110",
                createdAt: new Date("2021-09-15T00:00:00.000Z"),
                modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                type: "ACCOUNTS_RECEIVABLE",
                contact: "contact",
                number: "AIQ12546",
                issueDate: new Date("2020-03-31T00:00:00.000Z"),
                dueDate: new Date("2020-04-15T00:00:00.000Z"),
                paidOnDate: new Date("2020-04-01T00:00:00.000Z"),
                memo: "Weekly Payment",
                company: "company",
                employee: "employee",
                currency: "XUA",
                exchangeRate: "2.9",
                paymentTerm: "payment_term",
                totalDiscount: 1.1,
                subTotal: 100,
                status: "PAID",
                totalTaxAmount: 5,
                totalAmount: 105,
                balance: 105,
                remoteUpdatedAt: new Date("2020-04-01T00:00:00.000Z"),
                trackingCategories: [
                    "7dc5ca17-d311-44cd-9ce0-333080367a18",
                    "6aa0700c-48e1-4c4a-8162-02e6a582df05",
                    "8c933d61-8f5b-4360-ac0c-c9dc87bee763",
                ],
                accountingPeriod: "accounting_period",
                purchaseOrders: [
                    "e7378d8f-3992-4c2a-8417-ebdc4f2bfeb7",
                    "dd70ca2f-b120-46fa-889a-9604037f45fd",
                    "889b281d-739c-4759-95b8-0aedb3947131",
                ],
                payments: ["b26fd49a-cbae-470a-a8f8-bcbc119e0390"],
                appliedPayments: ["9017594e-dc33-4113-a5d2-b0f928e34fdd"],
                lineItems: [
                    {
                        id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                        remoteId: "8765432",
                        createdAt: new Date("2021-09-15T00:00:00.000Z"),
                        modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                        description: "Pickleball lessons",
                        unitPrice: 50,
                        quantity: 1,
                        totalAmount: 50,
                        employee: "7442f0d5-722d-45bd-b807-6e38489d37fe",
                        project: "22e65a5d-2df5-4e6e-884a-e538d0339000",
                        contact: "908934-49j9-093f-0989-908923908",
                        currency: "USD",
                        exchangeRate: "2.9",
                        item: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        account: "cd0f32d4-a493-11ec-b909-0242ac120002",
                        taxRate: "a12e7c20-1922-9df7-s75n-edfeewnn7384",
                        trackingCategories: [
                            "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                            "9b840d2-686a-465a-8a8e-7b028498f8e4",
                            "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                        ],
                        company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    },
                ],
                appliedCreditNotes: [
                    {
                        createdAt: new Date("2021-09-15T00:00:00.000Z"),
                        modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                        creditNote: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        appliedDate: new Date("2020-03-31T00:00:00.000Z"),
                        appliedAmount: "2.9",
                    },
                ],
                appliedVendorCredits: [
                    {
                        createdAt: new Date("2021-09-15T00:00:00.000Z"),
                        modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                        vendorCredit: "5b3c1341-a20f-4e51-b72c-f3830a16c97b",
                        appliedDate: new Date("2020-03-31T00:00:00.000Z"),
                        appliedAmount: "2.9",
                    },
                ],
                inclusiveOfTax: true,
                remoteWasDeleted: true,
                fieldMappings: {
                    organization_defined_targets: {
                        custom_key: "custom_value",
                    },
                    linked_account_defined_targets: {
                        custom_key: "custom_value",
                    },
                },
                remoteData: [
                    {
                        path: "/actions",
                        data: ["Varies by platform"],
                    },
                ],
                remoteFields: [
                    {
                        remoteFieldClass: "remote_field_class",
                    },
                ],
            },
            warnings: [
                {
                    source: {
                        pointer: "pointer",
                    },
                    title: "Unrecognized Field",
                    detail: "An unrecognized field, age, was passed in with request data.",
                    problemType: "UNRECOGNIZED_FIELD",
                },
            ],
            errors: [
                {
                    source: {
                        pointer: "pointer",
                    },
                    title: "Missing Required Field",
                    detail: "custom_fields is a required field on model.",
                    problemType: "MISSING_REQUIRED_FIELD",
                },
            ],
            logs: [
                {
                    logId: "99433219-8017-4acd-bb3c-ceb23d663832",
                    dashboardView: "https://app.merge.dev/logs/99433219-8017-4acd-bb3c-ceb23d663832",
                    logSummary: {
                        url: "www.exampleintegration.com/api/v1/exampleapi",
                        method: "POST",
                        statusCode: 200,
                    },
                },
            ],
        });
    });

    test("lineItemsRemoteFieldClassesList", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "id",
                    display_name: "display_name",
                    remote_key_name: "remote_key_name",
                    description: "description",
                    is_custom: true,
                    is_common_model_field: true,
                    is_required: true,
                    field_type: "string",
                    field_format: "string",
                    field_choices: ["field_choices"],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/invoices/line-items/remote-field-classes")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.invoices.lineItemsRemoteFieldClassesList();
        expect(response).toEqual({
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "id",
                    displayName: "display_name",
                    remoteKeyName: "remote_key_name",
                    description: "description",
                    isCustom: true,
                    isCommonModelField: true,
                    isRequired: true,
                    fieldType: "string",
                    fieldFormat: "string",
                    fieldChoices: ["field_choices"],
                },
            ],
        });
    });

    test("metaPatchRetrieve", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            request_schema: {
                type: "object",
                properties: {
                    model: {
                        type: "object",
                        required: [
                            "last_name",
                            "first_name",
                            "merge_categories",
                            "new_york_city_neighborhood",
                            "favorite_tv_shows",
                            "favorite_watch",
                        ],
                        properties: {
                            email_addresses: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: { type: "string", title: "value" },
                                        email_address_type: { type: "string", title: "email_address_type" },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "email_addresses",
                                description: "Array of email_addresses objects",
                            },
                            urls: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: { type: "string", title: "value" },
                                        url_type: { type: "string", title: "url_type" },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "urls",
                                description: "Array of urls objects",
                            },
                            first_name: { type: "string", title: "first_name", description: "The first name." },
                            last_name: { type: "string", title: "last_name", description: "The last name." },
                            phone_numbers: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: { type: "string", title: "value" },
                                        phone_number_type: { type: "string", title: "phone_number_type" },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "phone_numbers",
                                description: "Array of phone_numbers objects",
                            },
                            tags: {
                                type: "array",
                                items: { type: "string", format: "uuid" },
                                title: "tags",
                                description: "Array of tags names",
                            },
                            attachments: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        id: { type: "string", title: "id" },
                                        file_url: { type: "string", title: "file_url" },
                                        file_name: { type: "string", title: "file_name" },
                                        attachment_type: { type: "string", title: "attachment_type" },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "attachments",
                                description: "Array of attachments objects ",
                            },
                            merge_categories: {
                                type: "array",
                                categories: {
                                    type: "string",
                                    enum: [
                                        "HRIS",
                                        "ATS",
                                        "Accounting",
                                        "Ticketing",
                                        "File Storage",
                                        "CRM",
                                        "Marketing Automation",
                                    ],
                                    enum_information: [
                                        { value: "HRIS", description: "Merge HRIS Category" },
                                        { value: "ATS", description: "Merge ATS Category" },
                                        { value: "Accounting", description: "Merge Accounting Category" },
                                        { value: "Ticketing", description: "Merge Ticketing Category" },
                                        { value: "File Storage", description: "Merge File Storage Category" },
                                        { value: "CRM", description: "Merge CRM Category" },
                                        {
                                            value: "Marketing Automation",
                                            description: "Merge Marketing Automation Category",
                                        },
                                    ],
                                },
                                title: "Merge Categories",
                                description: "Array of Merge's Unified API Categories",
                            },
                            new_york_city_neighborhood: {
                                type: "string",
                                title: "Borough",
                                description: "One of the 5 Boroughs of New York City",
                            },
                            favorite_tv_shows: {
                                type: "array",
                                items: { type: "string", format: "uuid" },
                                title: "Favorite TV Shows",
                                description: "Array of TV Show objects on merge.tv_shows",
                            },
                            favorite_watch: {
                                type: "string",
                                title: "Favorite Watch",
                                description: "Favorite watch of all time",
                            },
                        },
                    },
                },
            },
            remote_field_classes: { key: "value" },
            status: { linked_account_status: "linked_account_status", can_make_request: true },
            has_conditional_params: true,
            has_required_linked_account_params: true,
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/invoices/meta/patch/id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.invoices.metaPatchRetrieve("id");
        expect(response).toEqual({
            requestSchema: {
                type: "object",
                properties: {
                    model: {
                        type: "object",
                        required: [
                            "last_name",
                            "first_name",
                            "merge_categories",
                            "new_york_city_neighborhood",
                            "favorite_tv_shows",
                            "favorite_watch",
                        ],
                        properties: {
                            email_addresses: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: {
                                            type: "string",
                                            title: "value",
                                        },
                                        email_address_type: {
                                            type: "string",
                                            title: "email_address_type",
                                        },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "email_addresses",
                                description: "Array of email_addresses objects",
                            },
                            urls: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: {
                                            type: "string",
                                            title: "value",
                                        },
                                        url_type: {
                                            type: "string",
                                            title: "url_type",
                                        },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "urls",
                                description: "Array of urls objects",
                            },
                            first_name: {
                                type: "string",
                                title: "first_name",
                                description: "The first name.",
                            },
                            last_name: {
                                type: "string",
                                title: "last_name",
                                description: "The last name.",
                            },
                            phone_numbers: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: {
                                            type: "string",
                                            title: "value",
                                        },
                                        phone_number_type: {
                                            type: "string",
                                            title: "phone_number_type",
                                        },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "phone_numbers",
                                description: "Array of phone_numbers objects",
                            },
                            tags: {
                                type: "array",
                                items: {
                                    type: "string",
                                    format: "uuid",
                                },
                                title: "tags",
                                description: "Array of tags names",
                            },
                            attachments: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            title: "id",
                                        },
                                        file_url: {
                                            type: "string",
                                            title: "file_url",
                                        },
                                        file_name: {
                                            type: "string",
                                            title: "file_name",
                                        },
                                        attachment_type: {
                                            type: "string",
                                            title: "attachment_type",
                                        },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "attachments",
                                description: "Array of attachments objects ",
                            },
                            merge_categories: {
                                type: "array",
                                categories: {
                                    type: "string",
                                    enum: [
                                        "HRIS",
                                        "ATS",
                                        "Accounting",
                                        "Ticketing",
                                        "File Storage",
                                        "CRM",
                                        "Marketing Automation",
                                    ],
                                    enum_information: [
                                        {
                                            value: "HRIS",
                                            description: "Merge HRIS Category",
                                        },
                                        {
                                            value: "ATS",
                                            description: "Merge ATS Category",
                                        },
                                        {
                                            value: "Accounting",
                                            description: "Merge Accounting Category",
                                        },
                                        {
                                            value: "Ticketing",
                                            description: "Merge Ticketing Category",
                                        },
                                        {
                                            value: "File Storage",
                                            description: "Merge File Storage Category",
                                        },
                                        {
                                            value: "CRM",
                                            description: "Merge CRM Category",
                                        },
                                        {
                                            value: "Marketing Automation",
                                            description: "Merge Marketing Automation Category",
                                        },
                                    ],
                                },
                                title: "Merge Categories",
                                description: "Array of Merge's Unified API Categories",
                            },
                            new_york_city_neighborhood: {
                                type: "string",
                                title: "Borough",
                                description: "One of the 5 Boroughs of New York City",
                            },
                            favorite_tv_shows: {
                                type: "array",
                                items: {
                                    type: "string",
                                    format: "uuid",
                                },
                                title: "Favorite TV Shows",
                                description: "Array of TV Show objects on merge.tv_shows",
                            },
                            favorite_watch: {
                                type: "string",
                                title: "Favorite Watch",
                                description: "Favorite watch of all time",
                            },
                        },
                    },
                },
            },
            remoteFieldClasses: {
                key: "value",
            },
            status: {
                linkedAccountStatus: "linked_account_status",
                canMakeRequest: true,
            },
            hasConditionalParams: true,
            hasRequiredLinkedAccountParams: true,
        });
    });

    test("metaPostRetrieve", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            request_schema: {
                type: "object",
                properties: {
                    model: {
                        type: "object",
                        required: [
                            "last_name",
                            "first_name",
                            "merge_categories",
                            "new_york_city_neighborhood",
                            "favorite_tv_shows",
                            "favorite_watch",
                        ],
                        properties: {
                            email_addresses: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: { type: "string", title: "value" },
                                        email_address_type: { type: "string", title: "email_address_type" },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "email_addresses",
                                description: "Array of email_addresses objects",
                            },
                            urls: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: { type: "string", title: "value" },
                                        url_type: { type: "string", title: "url_type" },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "urls",
                                description: "Array of urls objects",
                            },
                            first_name: { type: "string", title: "first_name", description: "The first name." },
                            last_name: { type: "string", title: "last_name", description: "The last name." },
                            phone_numbers: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: { type: "string", title: "value" },
                                        phone_number_type: { type: "string", title: "phone_number_type" },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "phone_numbers",
                                description: "Array of phone_numbers objects",
                            },
                            tags: {
                                type: "array",
                                items: { type: "string", format: "uuid" },
                                title: "tags",
                                description: "Array of tags names",
                            },
                            attachments: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        id: { type: "string", title: "id" },
                                        file_url: { type: "string", title: "file_url" },
                                        file_name: { type: "string", title: "file_name" },
                                        attachment_type: { type: "string", title: "attachment_type" },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "attachments",
                                description: "Array of attachments objects ",
                            },
                            merge_categories: {
                                type: "array",
                                categories: {
                                    type: "string",
                                    enum: [
                                        "HRIS",
                                        "ATS",
                                        "Accounting",
                                        "Ticketing",
                                        "File Storage",
                                        "CRM",
                                        "Marketing Automation",
                                    ],
                                    enum_information: [
                                        { value: "HRIS", description: "Merge HRIS Category" },
                                        { value: "ATS", description: "Merge ATS Category" },
                                        { value: "Accounting", description: "Merge Accounting Category" },
                                        { value: "Ticketing", description: "Merge Ticketing Category" },
                                        { value: "File Storage", description: "Merge File Storage Category" },
                                        { value: "CRM", description: "Merge CRM Category" },
                                        {
                                            value: "Marketing Automation",
                                            description: "Merge Marketing Automation Category",
                                        },
                                    ],
                                },
                                title: "Merge Categories",
                                description: "Array of Merge's Unified API Categories",
                            },
                            new_york_city_neighborhood: {
                                type: "string",
                                title: "Borough",
                                description: "One of the 5 Boroughs of New York City",
                            },
                            favorite_tv_shows: {
                                type: "array",
                                items: { type: "string", format: "uuid" },
                                title: "Favorite TV Shows",
                                description: "Array of TV Show objects on merge.tv_shows",
                            },
                            favorite_watch: {
                                type: "string",
                                title: "Favorite Watch",
                                description: "Favorite watch of all time",
                            },
                        },
                    },
                },
            },
            remote_field_classes: { key: "value" },
            status: { linked_account_status: "linked_account_status", can_make_request: true },
            has_conditional_params: true,
            has_required_linked_account_params: true,
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/invoices/meta/post")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.invoices.metaPostRetrieve();
        expect(response).toEqual({
            requestSchema: {
                type: "object",
                properties: {
                    model: {
                        type: "object",
                        required: [
                            "last_name",
                            "first_name",
                            "merge_categories",
                            "new_york_city_neighborhood",
                            "favorite_tv_shows",
                            "favorite_watch",
                        ],
                        properties: {
                            email_addresses: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: {
                                            type: "string",
                                            title: "value",
                                        },
                                        email_address_type: {
                                            type: "string",
                                            title: "email_address_type",
                                        },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "email_addresses",
                                description: "Array of email_addresses objects",
                            },
                            urls: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: {
                                            type: "string",
                                            title: "value",
                                        },
                                        url_type: {
                                            type: "string",
                                            title: "url_type",
                                        },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "urls",
                                description: "Array of urls objects",
                            },
                            first_name: {
                                type: "string",
                                title: "first_name",
                                description: "The first name.",
                            },
                            last_name: {
                                type: "string",
                                title: "last_name",
                                description: "The last name.",
                            },
                            phone_numbers: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        value: {
                                            type: "string",
                                            title: "value",
                                        },
                                        phone_number_type: {
                                            type: "string",
                                            title: "phone_number_type",
                                        },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "phone_numbers",
                                description: "Array of phone_numbers objects",
                            },
                            tags: {
                                type: "array",
                                items: {
                                    type: "string",
                                    format: "uuid",
                                },
                                title: "tags",
                                description: "Array of tags names",
                            },
                            attachments: {
                                type: "array",
                                items: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            title: "id",
                                        },
                                        file_url: {
                                            type: "string",
                                            title: "file_url",
                                        },
                                        file_name: {
                                            type: "string",
                                            title: "file_name",
                                        },
                                        attachment_type: {
                                            type: "string",
                                            title: "attachment_type",
                                        },
                                        integration_params: {
                                            type: "object",
                                            title: "integration_params",
                                            properties: {},
                                        },
                                        linked_account_params: {
                                            type: "object",
                                            title: "linked_account_params",
                                            properties: {},
                                        },
                                    },
                                },
                                title: "attachments",
                                description: "Array of attachments objects ",
                            },
                            merge_categories: {
                                type: "array",
                                categories: {
                                    type: "string",
                                    enum: [
                                        "HRIS",
                                        "ATS",
                                        "Accounting",
                                        "Ticketing",
                                        "File Storage",
                                        "CRM",
                                        "Marketing Automation",
                                    ],
                                    enum_information: [
                                        {
                                            value: "HRIS",
                                            description: "Merge HRIS Category",
                                        },
                                        {
                                            value: "ATS",
                                            description: "Merge ATS Category",
                                        },
                                        {
                                            value: "Accounting",
                                            description: "Merge Accounting Category",
                                        },
                                        {
                                            value: "Ticketing",
                                            description: "Merge Ticketing Category",
                                        },
                                        {
                                            value: "File Storage",
                                            description: "Merge File Storage Category",
                                        },
                                        {
                                            value: "CRM",
                                            description: "Merge CRM Category",
                                        },
                                        {
                                            value: "Marketing Automation",
                                            description: "Merge Marketing Automation Category",
                                        },
                                    ],
                                },
                                title: "Merge Categories",
                                description: "Array of Merge's Unified API Categories",
                            },
                            new_york_city_neighborhood: {
                                type: "string",
                                title: "Borough",
                                description: "One of the 5 Boroughs of New York City",
                            },
                            favorite_tv_shows: {
                                type: "array",
                                items: {
                                    type: "string",
                                    format: "uuid",
                                },
                                title: "Favorite TV Shows",
                                description: "Array of TV Show objects on merge.tv_shows",
                            },
                            favorite_watch: {
                                type: "string",
                                title: "Favorite Watch",
                                description: "Favorite watch of all time",
                            },
                        },
                    },
                },
            },
            remoteFieldClasses: {
                key: "value",
            },
            status: {
                linkedAccountStatus: "linked_account_status",
                canMakeRequest: true,
            },
            hasConditionalParams: true,
            hasRequiredLinkedAccountParams: true,
        });
    });

    test("remoteFieldClassesList", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "id",
                    display_name: "display_name",
                    remote_key_name: "remote_key_name",
                    description: "description",
                    is_custom: true,
                    is_common_model_field: true,
                    is_required: true,
                    field_type: "string",
                    field_format: "string",
                    field_choices: ["field_choices"],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/invoices/remote-field-classes")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.invoices.remoteFieldClassesList();
        expect(response).toEqual({
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "id",
                    displayName: "display_name",
                    remoteKeyName: "remote_key_name",
                    description: "description",
                    isCustom: true,
                    isCommonModelField: true,
                    isRequired: true,
                    fieldType: "string",
                    fieldFormat: "string",
                    fieldChoices: ["field_choices"],
                },
            ],
        });
    });
});
