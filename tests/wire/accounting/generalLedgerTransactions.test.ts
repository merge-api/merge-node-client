/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool.js";
import { MergeClient } from "../../../src/Client";

describe("GeneralLedgerTransactions", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "b26fd49a-cbae-470a-a8f8-bcbc119e0390",
                    remote_id: "987300",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    underlying_transaction_remote_id: "1234",
                    underlying_transaction_type: "INVOICE",
                    accounting_period: "accounting_period",
                    company: "company",
                    remote_updated_at: "2020-03-31T00:00:00Z",
                    remote_created_at: "2020-03-31T00:00:00Z",
                    tracking_categories: [
                        "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                        "9b840d2-686a-465a-8a8e-7b028498f8e4",
                        "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    ],
                    posting_date: "2020-03-31T00:00:00Z",
                    general_ledger_transaction_lines: [
                        {
                            id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                            remote_id: "123",
                            created_at: "2021-09-15T00:00:00Z",
                            modified_at: "2021-10-16T00:00:00Z",
                            account: "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                            contact: "d6e687d6-0c36-48a1-8114-35324b5cb38f",
                            base_currency: "USD",
                            transaction_currency: "USD",
                            exchange_rate: "exchange_rate",
                            description: "Invoice created",
                            tracking_categories: [
                                "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                                "9b840d2-686a-465a-8a8e-7b028498f8e4",
                                "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                            ],
                            debit_amount: "debit_amount",
                            credit_amount: "credit_amount",
                            item: "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                            foreign_debit_amount: "foreign_debit_amount",
                            foreign_credit_amount: "foreign_credit_amount",
                            remote_was_deleted: false,
                        },
                    ],
                    remote_was_deleted: true,
                    field_mappings: {
                        organization_defined_targets: { custom_key: "custom_value" },
                        linked_account_defined_targets: { custom_key: "custom_value" },
                    },
                    remote_data: [{ path: "/platform-endpoint" }],
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/general-ledger-transactions")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.generalLedgerTransactions.list();
        expect(response).toEqual({
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "b26fd49a-cbae-470a-a8f8-bcbc119e0390",
                    remoteId: "987300",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    underlyingTransactionRemoteId: "1234",
                    underlyingTransactionType: "INVOICE",
                    accountingPeriod: "accounting_period",
                    company: "company",
                    remoteUpdatedAt: new Date("2020-03-31T00:00:00.000Z"),
                    remoteCreatedAt: new Date("2020-03-31T00:00:00.000Z"),
                    trackingCategories: [
                        "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                        "9b840d2-686a-465a-8a8e-7b028498f8e4",
                        "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    ],
                    postingDate: new Date("2020-03-31T00:00:00.000Z"),
                    generalLedgerTransactionLines: [
                        {
                            id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                            remoteId: "123",
                            createdAt: new Date("2021-09-15T00:00:00.000Z"),
                            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                            account: "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                            company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                            contact: "d6e687d6-0c36-48a1-8114-35324b5cb38f",
                            baseCurrency: "USD",
                            transactionCurrency: "USD",
                            exchangeRate: "exchange_rate",
                            description: "Invoice created",
                            trackingCategories: [
                                "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                                "9b840d2-686a-465a-8a8e-7b028498f8e4",
                                "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                            ],
                            debitAmount: "debit_amount",
                            creditAmount: "credit_amount",
                            item: "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                            foreignDebitAmount: "foreign_debit_amount",
                            foreignCreditAmount: "foreign_credit_amount",
                            remoteWasDeleted: false,
                        },
                    ],
                    remoteWasDeleted: true,
                    fieldMappings: {
                        organization_defined_targets: {
                            custom_key: "custom_value",
                        },
                        linked_account_defined_targets: {
                            custom_key: "custom_value",
                        },
                    },
                    remoteData: [
                        {
                            path: "/platform-endpoint",
                        },
                    ],
                },
            ],
        });
    });

    test("retrieve", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "b26fd49a-cbae-470a-a8f8-bcbc119e0390",
            remote_id: "987300",
            created_at: "2021-09-15T00:00:00Z",
            modified_at: "2021-10-16T00:00:00Z",
            underlying_transaction_remote_id: "1234",
            underlying_transaction_type: "INVOICE",
            accounting_period: "accounting_period",
            company: "company",
            remote_updated_at: "2020-03-31T00:00:00Z",
            remote_created_at: "2020-03-31T00:00:00Z",
            tracking_categories: [
                "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                "9b840d2-686a-465a-8a8e-7b028498f8e4",
                "a47e11b6-c73b-4a0c-be31-130fc48177fa",
            ],
            posting_date: "2020-03-31T00:00:00Z",
            general_ledger_transaction_lines: [
                {
                    id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                    remote_id: "123",
                    created_at: "2021-09-15T00:00:00Z",
                    modified_at: "2021-10-16T00:00:00Z",
                    account: "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    employee: "employee",
                    contact: "d6e687d6-0c36-48a1-8114-35324b5cb38f",
                    project: "project",
                    base_currency: "USD",
                    transaction_currency: "USD",
                    exchange_rate: "exchange_rate",
                    description: "Invoice created",
                    tracking_categories: [
                        "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                        "9b840d2-686a-465a-8a8e-7b028498f8e4",
                        "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    ],
                    debit_amount: "debit_amount",
                    credit_amount: "credit_amount",
                    item: "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    foreign_debit_amount: "foreign_debit_amount",
                    foreign_credit_amount: "foreign_credit_amount",
                    remote_was_deleted: false,
                    field_mappings: {
                        organization_defined_targets: { custom_key: "custom_value" },
                        linked_account_defined_targets: { custom_key: "custom_value" },
                    },
                },
            ],
            remote_was_deleted: true,
            field_mappings: {
                organization_defined_targets: { custom_key: "custom_value" },
                linked_account_defined_targets: { custom_key: "custom_value" },
            },
            remote_data: [{ path: "/platform-endpoint", data: { key: "value" } }],
        };
        server
            .mockEndpoint()
            .get("/accounting/v1/general-ledger-transactions/id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.accounting.generalLedgerTransactions.retrieve("id");
        expect(response).toEqual({
            id: "b26fd49a-cbae-470a-a8f8-bcbc119e0390",
            remoteId: "987300",
            createdAt: new Date("2021-09-15T00:00:00.000Z"),
            modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
            underlyingTransactionRemoteId: "1234",
            underlyingTransactionType: "INVOICE",
            accountingPeriod: "accounting_period",
            company: "company",
            remoteUpdatedAt: new Date("2020-03-31T00:00:00.000Z"),
            remoteCreatedAt: new Date("2020-03-31T00:00:00.000Z"),
            trackingCategories: [
                "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                "9b840d2-686a-465a-8a8e-7b028498f8e4",
                "a47e11b6-c73b-4a0c-be31-130fc48177fa",
            ],
            postingDate: new Date("2020-03-31T00:00:00.000Z"),
            generalLedgerTransactionLines: [
                {
                    id: "ecbe05ac-62a3-46c5-ab31-4b478b37d1b4",
                    remoteId: "123",
                    createdAt: new Date("2021-09-15T00:00:00.000Z"),
                    modifiedAt: new Date("2021-10-16T00:00:00.000Z"),
                    account: "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    company: "595c8f97-2ac4-45b7-b000-41bdf43240b5",
                    employee: "employee",
                    contact: "d6e687d6-0c36-48a1-8114-35324b5cb38f",
                    project: "project",
                    baseCurrency: "USD",
                    transactionCurrency: "USD",
                    exchangeRate: "exchange_rate",
                    description: "Invoice created",
                    trackingCategories: [
                        "b38c59b0-a9d7-4740-b1ee-5436c6751e3d",
                        "9b840d2-686a-465a-8a8e-7b028498f8e4",
                        "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    ],
                    debitAmount: "debit_amount",
                    creditAmount: "credit_amount",
                    item: "a47e11b6-c73b-4a0c-be31-130fc48177fa",
                    foreignDebitAmount: "foreign_debit_amount",
                    foreignCreditAmount: "foreign_credit_amount",
                    remoteWasDeleted: false,
                    fieldMappings: {
                        organization_defined_targets: {
                            custom_key: "custom_value",
                        },
                        linked_account_defined_targets: {
                            custom_key: "custom_value",
                        },
                    },
                },
            ],
            remoteWasDeleted: true,
            fieldMappings: {
                organization_defined_targets: {
                    custom_key: "custom_value",
                },
                linked_account_defined_targets: {
                    custom_key: "custom_value",
                },
            },
            remoteData: [
                {
                    path: "/platform-endpoint",
                    data: {
                        key: "value",
                    },
                },
            ],
        });
    });
});
