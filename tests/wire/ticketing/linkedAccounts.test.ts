/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool.js";
import { MergeClient } from "../../../src/Client";

describe("LinkedAccounts", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new MergeClient({ apiKey: "test", accountToken: "test", environment: server.baseUrl });

        const rawResponseBody = {
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "e59b1821-f85c-4e28-a6b3-1804156f3563",
                    category: "hris",
                    status: "COMPLETE",
                    status_detail: "Invalid login credentials",
                    end_user_origin_id: "3ac95cde-6c7f-4eef-afec-be710b42308d",
                    end_user_organization_name: "Foo Bar, LLC",
                    end_user_email_address: "hradmin@foobar.dev",
                    subdomain: "foobar",
                    webhook_listener_url: "https://api.merge.dev/api/integrations/webhook-listener/7fc3mee0UW8ecV4",
                    is_duplicate: true,
                    integration: {
                        name: "name",
                        categories: ["hris"],
                        color: "color",
                        slug: "slug",
                        passthrough_available: true,
                        available_model_operations: [
                            {
                                model_name: "Candidate",
                                available_operations: ["FETCH", "CREATE"],
                                required_post_parameters: ["remote_user_id"],
                                supported_fields: ["first_name", "last_name", "company", "title"],
                            },
                        ],
                    },
                    account_type: "PRODUCTION",
                    completed_at: "2024-08-26T20:11:19Z",
                    integration_specific_fields: { integration_specific_field: "Varies by platform" },
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/ticketing/v1/linked-accounts")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.ticketing.linkedAccounts.list();
        expect(response).toEqual({
            next: "cD0yMDIxLTAxLTA2KzAzJTNBMjQlM0E1My40MzQzMjYlMkIwMCUzQTAw",
            previous: "cj1sZXdwd2VycWVtY29zZnNkc2NzUWxNMEUxTXk0ME16UXpNallsTWtJ",
            results: [
                {
                    id: "e59b1821-f85c-4e28-a6b3-1804156f3563",
                    category: "hris",
                    status: "COMPLETE",
                    statusDetail: "Invalid login credentials",
                    endUserOriginId: "3ac95cde-6c7f-4eef-afec-be710b42308d",
                    endUserOrganizationName: "Foo Bar, LLC",
                    endUserEmailAddress: "hradmin@foobar.dev",
                    subdomain: "foobar",
                    webhookListenerUrl: "https://api.merge.dev/api/integrations/webhook-listener/7fc3mee0UW8ecV4",
                    isDuplicate: true,
                    integration: {
                        name: "name",
                        categories: ["hris"],
                        color: "color",
                        slug: "slug",
                        passthroughAvailable: true,
                        availableModelOperations: [
                            {
                                modelName: "Candidate",
                                availableOperations: ["FETCH", "CREATE"],
                                requiredPostParameters: ["remote_user_id"],
                                supportedFields: ["first_name", "last_name", "company", "title"],
                            },
                        ],
                    },
                    accountType: "PRODUCTION",
                    completedAt: new Date("2024-08-26T20:11:19.000Z"),
                    integrationSpecificFields: {
                        integration_specific_field: "Varies by platform",
                    },
                },
            ],
        });
    });
});
